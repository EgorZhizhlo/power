{% extends 'base.html' %}

{% set is_create = (view_type == 'create') %}
{% block title %}
  {{ last_name|capitalize }} {{ name|capitalize }} {{ patronymic|capitalize }} |
  {% if is_create %}–î–æ–±–∞–≤–ª–µ–Ω–∏–µ{% else %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% endif %} –Ω–æ–º–µ—Ä–∞ –±–ª–∞–Ω–∫–∞
{% endblock %}

{% block content %}
  <h1 class="fs-xl d-flex flex-column align-items-center mb-4">
    {% if company_image %}
      <div class="photo mb-3">
        <img src="data:image/jpeg;base64,{{ company_image }}"
             alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏: {{ company_name }}">
      </div>
    {% endif %}

    <div class="btn-group mb-3">
      <a href="/companies/act-numbers?company_id={{company_id}}"
         class="btn btn-outline-secondary label-text fw-bold"
        style="border-width: 3px;">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</a>
      <a href="/companies/company?company_id={{company_id}}"
         class="btn btn-outline-dark label-text fw-bold"
        style="border-width: 3px;">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>

    {% if is_create %}–î–æ–±–∞–≤–ª–µ–Ω–∏–µ{% else %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% endif %} –Ω–æ–º–µ—Ä–∞ –±–ª–∞–Ω–∫–∞
  </h1>

  <div class="card p-4 mb-5">
    <form 
      id="act-number-form"
      method="{% if is_create %}POST{% else %}PUT{% endif %}"
      action="
      {% if is_create %}
        /companies/api/act-numbers/create?company_id={{company_id}}
      {% else %}
        /companies/api/act-numbers/update?company_id={{company_id}}&act_number_id={{act_number_entry.id}}
      {% endif %}">

      <div class="row g-3">
        <!-- –ù–æ–º–µ—Ä –±–ª–∞–Ω–∫–∞ -->
        <div class="col-12 col-lg-6">
          <label for="act_number" class="form-label label-text"><b>–ù–æ–º–µ—Ä –±–ª–∞–Ω–∫–∞</b></label>
          <input type="number"
                 id="act_number"
                 name="act_number"
                 class="form-control text-center input-text"
                 value="{{ act_number_entry.act_number if not is_create else '' }}"
                 required>
        </div>

        <!-- –§–∏–∑/—é—Ä –ª–∏—Ü–æ -->
        <div class="col-12 col-lg-6">
          <label for="legal_entity" class="form-label label-text"><b>–§–∏–∑./–Æ—Ä. –ª–∏—Ü–æ</b></label>
          <select id="legal_entity"
                  name="legal_entity"
                  class="form-select text-center input-text"
                  required>
            {% if is_create %}
              <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
            {% endif %}
            <option value="individual" {% if not is_create and act_number_entry.legal_entity == 'individual' %}selected{% endif %}>–§–∏–∑. –ª–∏—Ü–æ</option>
            <option value="legal" {% if not is_create and act_number_entry.legal_entity == 'legal' %}selected{% endif %}>–Æ—Ä. –ª–∏—Ü–æ</option>
          </select>
        </div>

        <!-- –§–ò–û -->
        <div class="col-12 col-lg-6">
          <label for="client_full_name" class="form-label label-text"><b>–§–ò–û –∫–ª–∏–µ–Ω—Ç–∞</b></label>
          <input type="text"
                 id="client_full_name"
                 name="client_full_name"
                 class="form-control text-center input-text"
                 value="{{ act_number_entry.client_full_name if not is_create else '' }}"
                 required>
        </div>

        <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
        <div class="col-12 col-lg-6">
          <label for="client_phone" class="form-label label-text"><b>–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</b></label>
          <input type="tel"
                 id="client_phone"
                 name="client_phone"
                 class="form-control text-center input-text"
                 placeholder="+7 (___) ___-__-__"
                 value="{{ act_number_entry.client_phone if not is_create else '' }}"
                 required>
        </div>

        <!-- –ê–¥—Ä–µ—Å (–ø–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞) -->
        <div class="col-12 col-lg-6"">
          <label for="address" class="form-label label-text"><b>–ê–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞</b></label>
          <input type="text"
                 id="address"
                 name="address"
                 class="form-control text-center input-text"
                 value="{{ act_number_entry.address if not is_create else '' }}"
                 required>
        </div>

        <!-- –ì–æ—Ä–æ–¥ -->
        <div class="col-12 col-lg-6">
          <label for="city_id" class="form-label label-text"><b>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</b></label>
          <select id="city_id"
                  name="city_id"
                  class="form-select text-center input-text"
                  required>
            {% if is_create %}
              <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</option>
            {% endif %}
            {% for c in cities %}
              <option value="{{ c.id }}"
                {% if not is_create and c.id==act_number_entry.city_id %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- –°–µ—Ä–∏—è –∞–∫—Ç–∞ -->
        <div class="col-12 col-lg-6">
          <label for="series_id" class="form-label label-text"><b>–°–µ—Ä–∏—è –∞–∫—Ç–∞</b></label>
          <select id="series_id"
                  name="series_id"
                  class="form-select text-center input-text"
                  required>
            {% if is_create %}
              <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é</option>
            {% endif %}
            {% for s in act_series %}
              <option value="{{ s.id }}"
                {% if not is_create and s.id==act_number_entry.series_id %}selected{% endif %}>{{ s.name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- –î–∞—Ç–∞ –ø–æ–≤–µ—Ä–∫–∏ -->
        <div class="col-12 col-lg-6">
          <label for="verification_date" class="form-label label-text"><b>–î–∞—Ç–∞ –ø–æ–≤–µ—Ä–∫–∏</b></label>
          <input type="date"
                 id="verification_date"
                 name="verification_date"
                 class="form-control text-center input-text"
                 value="{{ act_number_entry.verification_date if not is_create else '' }}"
                 required>
        </div>

        <!-- –ü—É—Å—Ç–∞—è –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ (–Ω–∞ md) -->
        <div class="col-12 col-lg-6 d-none d-md-block"></div>

        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <div class="col-12 d-flex justify-content-end mt-2">
          <button type="submit" class="btn btn-outline-success label-text fw-bold" style="border-width: 3px;">
            ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/imask@7.6.0/dist/imask.min.js"></script>
  <script>
    window.companyId = {{ company_id }};
    window.isCreate = {{ is_create|tojson }};
    {% if not is_create %}
    window.actNumberId = {{ act_number.id }};
    {% endif %}
  </script>
  <script type="module" src="/static/company/act_numbers/js/update_or_create.js"></script>
{% endblock %}