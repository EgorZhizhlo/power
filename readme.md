# Powerka - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–≤–µ—Ä–∫–∞–º–∏

FastAPI-based –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–≤–µ—Ä–∫–∞–º–∏ –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–µ—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker & Docker Compose
- Python 3.13+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- PostgreSQL 16
- Redis 7

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd powerka
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è:
- `DB_PASSWORD`
- `SECRET_KEY` (–º–∏–Ω–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞)
- `SALT` (–º–∏–Ω–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞)
- `ADMIN_PASSWORD`
- `REDIS_URL` (–ø–∞—Ä–æ–ª—å Redis)

### 3. –°–æ–∑–¥–∞–Ω–∏–µ Docker volumes

```bash
make volumes-create
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
make prod
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –°–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ volumes
- –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- –ó–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

### 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
make migrate
```

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
make health
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost`

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
powerka/
‚îú‚îÄ‚îÄ access_control/      # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, middleware
‚îú‚îÄ‚îÄ apps/                # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ auth_app/
‚îÇ   ‚îú‚îÄ‚îÄ calendar_app/
‚îÇ   ‚îú‚îÄ‚îÄ company_app/
‚îÇ   ‚îú‚îÄ‚îÄ tariff_app/
‚îÇ   ‚îî‚îÄ‚îÄ verification_app/
‚îú‚îÄ‚îÄ core/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ docker/              # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.prod.yml
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.test.yml
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.migrate.yml
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ infrastructure/      # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ë–î, –∫–µ—à, nginx)
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îî‚îÄ‚îÄ static/
‚îú‚îÄ‚îÄ models/              # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ alembic.ini          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ Makefile             # –ö–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ .env                 # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è!)
```

## üõ† Makefile –∫–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
make help              # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make prod              # –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
make up                # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make down              # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make restart           # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make logs              # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make ps                # –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
make dev               # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make install           # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make run-local         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å hot-reload
make test-up           # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make test-down         # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
make migrate                        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-create MSG="–æ–ø–∏—Å–∞–Ω–∏–µ"  # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
make migrate-history                # –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
make migrate-current                # –¢–µ–∫—É—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
```

### Shell –¥–æ—Å—Ç—É–ø

```bash
make shell             # –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make db-shell          # PostgreSQL CLI
make redis-shell       # Redis CLI
```

### –ë—ç–∫–∞–ø—ã

```bash
make backup-db                     # –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î
make restore-db FILE=path/to.sql   # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
make stats             # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make health            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤
make logs-app          # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make logs-db           # –õ–æ–≥–∏ PostgreSQL
make logs-redis        # –õ–æ–≥–∏ Redis
```

### –û—á–∏—Å—Ç–∫–∞

```bash
make clean             # –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
make volumes-clean     # –û–ü–ê–°–ù–û: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ volumes —Å –¥–∞–Ω–Ω—ã–º–∏
```

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ë–µ–∑ Docker

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python3 -m venv .venv
source .venv/bin/activate
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r docker/requirements.txt
pip install "uvicorn[standard]"
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Makefile:
```bash
make install
make run-local
```

### –° Docker (—Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ)

```bash
make test-up
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://localhost:8000` —Å hot-reload.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Apps)

–ü—Ä–æ–µ–∫—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø–æ –¥–æ–º–µ–Ω–∞–º:
- **auth_app** - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- **calendar_app** - –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞—è–≤–æ–∫ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- **company_app** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
- **tariff_app** - –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –ª–∏–º–∏—Ç—ã
- **verification_app** - –ü–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã

### Middleware

- **AuthMiddleware** - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- **TariffMiddleware** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **PostgreSQL 16** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- **SQLAlchemy 2.0** (async)
- **Alembic** –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- **Redis** –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—á–µ—Ä–µ–¥–µ–π

### Frontend

- Jinja2 templates
- Vanilla JS (ES6+)
- Select2 –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤
- IMask –¥–ª—è –º–∞—Å–æ–∫ –≤–≤–æ–¥–∞

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Redis
- –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ (auth + company_info)
- –†–æ–ª–µ-based –¥–æ—Å—Ç—É–ø (RBAC)
- –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
make health
```

### –õ–æ–≥–∏

```bash
make logs              # –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make logs-app          # –¢–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
make logs-db           # –¢–æ–ª—å–∫–æ –ë–î
make logs-redis        # –¢–æ–ª—å–∫–æ Redis
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
make stats
```

## üóÑ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ë—ç–∫–∞–ø

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø —Å –¥–∞—Ç–æ–π:
```bash
make backup-db
```

–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `dumps/backup_YYYYMMDD_HHMMSS.sql`

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
make restore-db FILE=dumps/backup_20250110_123456.sql
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
make prod-update
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑—ã –±–µ–∑ –∫–µ—à–∞
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ volumes

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
make shell
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
make logs-app
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î

```bash
make db-shell
# –ó–∞—Ç–µ–º –≤ psql:
\dt                    # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
SELECT * FROM users;   # –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis

```bash
make redis-shell
# –ó–∞—Ç–µ–º –≤ redis-cli:
KEYS *                 # –í—Å–µ –∫–ª—é—á–∏
GET key_name           # –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
```

## üìù –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
make migrate-create MSG="–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–∞—Ä–∏—Ñ–æ–≤"
```

–ú–∏–≥—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –≤ `infrastructure/db/migrations/versions/`

## üö¢ Production –¥–µ–ø–ª–æ–π

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
make volumes-create
make prod
make migrate
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω –≤ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `make logs`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ: `make health`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `make ps`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary - –≤—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
